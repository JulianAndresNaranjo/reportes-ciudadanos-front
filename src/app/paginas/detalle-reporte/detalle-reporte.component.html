<ng-container *ngIf="reporte; else cargando">
  <div class="reporte-detalle-container">
    <h1 class="titulo">{{ reporte.title }}</h1>

    <div class="info">
      <p><strong>ğŸ“ DescripciÃ³n:</strong> {{ reporte.description }}</p>
      <p><strong>ğŸ“‚ CategorÃ­a:</strong> {{ nombreCategoria }}</p>
      <p><strong>ğŸ“ UbicaciÃ³n:</strong>
        {{ reporte.location?.latitude ?? 'â€”' }}, {{ reporte.location?.longitude ?? 'â€”' }}
      </p>
      <p><strong>ğŸ“Œ Estado:</strong> {{ reporte.status ?? 'Sin estado' }}</p>
      <p><strong>ğŸ“… Fecha:</strong> {{ reporte.dateCreation ?? 'Sin fecha' }}</p>
      <p><strong>â­ Importante:</strong>
        <span *ngIf="reporte.isImportant; else noImportante"> SÃ­</span>
        <ng-template #noImportante> No</ng-template>
      </p>

      <div *ngIf="reporte.photo">
        <p><strong>ğŸ–¼ Foto:</strong></p>
        <img [src]="reporte.photo" alt="Foto del reporte"
          style="max-width: 100%; border-radius: 10px; margin-top: 1rem;">
      </div>
    </div>

    <!-- Botones de acciÃ³n -->
    <div class="acciones-inferiores" *ngIf="reporte.status?.toUpperCase() !== 'RESUELTO'">
      <button (click)="marcarComoResuelto()" class="btn-resuelto">
        âœ… Marcar como Resuelto
      </button>
      <button (click)="eliminarReporte()" class="btn-eliminar" style="margin-left: 1rem;">
        ğŸ—‘ Eliminar Reporte
      </button>
    </div>

    <!-- Comentarios -->
    <div class="comentarios-section">
      <h2>ğŸ—¨ï¸ Comentarios</h2>
      <div *ngIf="comentarios?.length; else sinComentarios">
        <div *ngFor="let comentario of comentarios" class="comentario">
          <div class="comentario-header">
            <span class="usuario">ğŸ§‘ Usuario: {{ comentario.userName }}</span>
            <span class="fecha">{{ comentario.createdAt | date:'short' }}</span>
          </div>
          <p class="mensaje">{{ comentario.message }}</p>
          <div *ngIf="comentario.userId === userIdActual">
            <button (click)="eliminarComentario(comentario.id)" class="btn-eliminar">ğŸ—‘ Eliminar</button>
          </div>
        </div>
      </div>
      <ng-template #sinComentarios>
        <p class="sin-comentarios">No hay comentarios todavÃ­a.</p>
      </ng-template>
    </div>

    <!-- Formulario comentario -->
    <div class="form-comentario">
      <h3>âœï¸ Agregar Comentario</h3>
      <textarea [(ngModel)]="nuevoComentario" placeholder="Escribe tu comentario..."></textarea>
      <div class="botones-accion">
        <button (click)="agregarComentario()" [disabled]="comentarioCargando || !nuevoComentario.trim()">
          <ng-container *ngIf="!comentarioCargando; else cargandoBtn">
            Enviar
          </ng-container>
          <ng-template #cargandoBtn>
            <span class="spinner"></span> Enviando
          </ng-template>
        </button>
        <button (click)="volver()" class="btn-volver">Volver</button>
      </div>
    </div>

  </div>
</ng-container>

<ng-template #cargando>
  <div class="cargando">
    <p>Cargando reporte...</p>
  </div>
</ng-template>
